---
export interface Props {
    title: string;
    description?: string;
    image?: string;
}

const {
    title,
    description = "Wampoon provides a simple and elegant way to manage your WAMP stack. Start, stop, and configure Apache, MariaDB, and PHP with ease.",
    image = "/og-image.png"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);
---

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={imageURL} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={imageURL} />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700;800&family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Paw Print Loading Spinner -->
    <div class="paw-loading" id="pawLoader">
        <div class="paw-step"></div>
        <div class="paw-step"></div>
        <div class="paw-step"></div>
        <div class="paw-step"></div>
    </div>

    <slot />

    <!-- Grain texture overlay -->
    <div class="grain-overlay" aria-hidden="true"></div>

    <script>
        // Paw loading animation.
        function showPawLoading() {
            const loader = document.getElementById('pawLoader');
            if (loader) {
                loader.classList.add('active');
            }
        }

        function hidePawLoading() {
            const loader = document.getElementById('pawLoader');
            if (loader) {
                loader.classList.remove('active');
            }
        }

        // Global theme toggle function - "Wake the raccoon!".
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            // Show paw loading animation.
            showPawLoading();
            
            // Small delay for the animation to be visible.
            setTimeout(() => {
                body.setAttribute('data-theme', newTheme);
                // Sync with both our theme system and Starlight's.
                localStorage.setItem('theme', newTheme);
                localStorage.setItem('starlight-theme', newTheme);
                updateThemeButton(newTheme);
                
                // Hide loading after theme change.
                setTimeout(hidePawLoading, 800);
            }, 200);
        }

        function updateThemeButton(theme) {
            const toggleButton = document.querySelector('.theme-toggle');
            const tooltipText = document.getElementById('tooltip-text');
            
            if (toggleButton) {
                if (theme === 'dark') {
                    // Trash icon (send to bed)
                    toggleButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`;
                } else {
                    // Bed icon (wake up)
                    toggleButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>`;
                }
            }
            
            if (tooltipText) {
                if (theme === 'dark') {
                    tooltipText.innerHTML = '<span class="raccoon-emoji">ü¶ù</span> Send raccoon to bed';
                } else {
                    tooltipText.innerHTML = '<span class="raccoon-emoji">ü¶ù</span> Wake raccoon for night foraging';
                }
            }
        }

        // Initialize theme when page loads.
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved theme, prioritizing Starlight's theme if available.
            const starlightTheme = localStorage.getItem('starlight-theme');
            const ourTheme = localStorage.getItem('theme');
            const savedTheme = starlightTheme || ourTheme || 'dark';
            
            // Sync both localStorage keys.
            localStorage.setItem('theme', savedTheme);
            localStorage.setItem('starlight-theme', savedTheme);
            
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);

            // Add click event listener to theme toggle button. 
            const toggleButton = document.querySelector('.theme-toggle');
            if (toggleButton) {
                toggleButton.addEventListener('click', toggleTheme);
            }
        });
    </script>
</body>
</html>

<style is:global>
    @import '../styles/global.css';
</style>